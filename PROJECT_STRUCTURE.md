# CloudLabs Personalizer - Complete Project Structure Documentation

## Overview

CloudLabs Personalizer is a Next.js 14 application that enables users to design custom packaging with a real-time 2D canvas editor and synchronized 3D preview. The application combines Konva for 2D canvas editing, Three.js for 3D rendering, and Zustand for state management to create an interactive design experience.

---

## Root Directory Files

### Configuration Files

#### `package.json`
- **Purpose**: Defines project metadata, dependencies, and npm scripts
- **Key Dependencies**:
  - `next@^14.2.33` - Next.js framework for React
  - `react@18.3.1` & `react-dom@18.3.1` - React library
  - `konva@9.3.12` - 2D canvas library
  - `react-konva@18.2.10` - React wrapper for Konva
  - `three@0.160.0` - 3D graphics library
  - `@react-three/fiber@8.15.16` - React renderer for Three.js
  - `@react-three/drei@9.105.6` - Useful helpers for react-three/fiber
  - `zustand@4.5.2` - Lightweight state management
- **Scripts**:
  - `npm run dev` - Start development server
  - `npm run build` - Build for production
  - `npm start` - Start production server
  - `npm run lint` - Run ESLint

#### `package-lock.json`
- **Purpose**: Locks exact versions of all dependencies and their sub-dependencies
- **Note**: Auto-generated file, ensures consistent installs across environments

#### `tsconfig.json`
- **Purpose**: TypeScript compiler configuration
- **Key Settings**:
  - Target: ES2017
  - Module: ESNext with bundler resolution
  - JSX: Preserve (for Next.js)
  - Strict mode enabled
  - Path alias: `@/*` maps to root directory
  - Includes all `.ts` and `.tsx` files, excludes `node_modules`

#### `next.config.mjs`
- **Purpose**: Next.js framework configuration
- **Key Settings**:
  - React strict mode enabled
  - Webpack alias: `canvas: false` (prevents server-side canvas issues)
- **Note**: Uses ES module syntax (`.mjs` extension)

#### `tailwind.config.ts`
- **Purpose**: Tailwind CSS configuration
- **Content Paths**: Scans `app/`, `components/`, and `lib/` directories for class usage
- **Theme**: Uses default Tailwind theme with no custom extensions

#### `postcss.config.mjs`
- **Purpose**: PostCSS configuration for CSS processing
- **Plugins**:
  - `tailwindcss` - Processes Tailwind directives
  - `autoprefixer` - Adds vendor prefixes automatically

#### `next-env.d.ts`
- **Purpose**: Auto-generated TypeScript definitions for Next.js
- **Note**: Should not be edited manually, regenerated by Next.js

---

### Documentation Files

#### `README.md`
- **Purpose**: Main project documentation
- **Contents**:
  - Project overview and goals
  - Getting started instructions
  - Application structure overview
  - Editor workflow explanation
  - Key technologies used
  - Development tips

#### `SETUP.md`
- **Purpose**: Detailed setup guide for Windows
- **Contents**:
  - Prerequisites and installation steps
  - Node.js version management (nvm-windows)
  - Dependency installation instructions
  - Troubleshooting guide
  - Explanation of React, Next.js, and Konva

---

## Directory Structure

### `/app` - Next.js App Router Directory

The `app` directory uses Next.js 14's App Router convention where file structure defines routing.

#### `app/layout.tsx`
- **Purpose**: Root layout component for all pages
- **Features**:
  - Defines global HTML structure (`<html>`, `<body>`)
  - Sets page metadata (title, description)
  - Imports global CSS styles
  - Includes Line Awesome icon font via CDN
  - Applies Tailwind base styles

#### `app/page.tsx`
- **Purpose**: Root route (`/`) handler
- **Functionality**: Automatically redirects to `/personalize` route
- **Implementation**: Uses Next.js `redirect()` function

#### `app/globals.css`
- **Purpose**: Global CSS stylesheet
- **Contents**:
  - Tailwind directives (`@tailwind base/components/utilities`)
  - Root color scheme (light mode)
  - Body background and text colors
  - Responsive sidebar scaling for small screens

#### `app/README.md`
- **Purpose**: Documentation for the app directory
- **Contents**: Explains App Router structure, routing, and component organization

#### `/app/personalize` - Main Editor Route

##### `app/personalize/page.tsx`
- **Purpose**: Main personalization editor page component
- **Route**: `/personalize`
- **Layout Structure**:
  - Top bar (branding, workspace controls)
  - Three-column responsive grid:
    - Left: Toolbar (240px)
    - Center: Canvas (flexible)
    - Right: 3D Preview (320px on XL screens)
  - Bottom: Properties panel
- **Components Used**:
  - `<TopBar />` - Header component
  - `<LeftToolbar />` - Sidebar with tools
  - `<ClientCanvas />` - Canvas wrapper
  - `<RightPanel3D />` - 3D preview panel
  - `<PropertiesPanel />` - Selection properties

##### `app/personalize/ClientCanvas.tsx`
- **Purpose**: Client-side wrapper for the canvas component
- **Implementation**: Uses Next.js dynamic import with `ssr: false`
- **Reason**: Prevents server-side rendering issues with Konva (browser-only APIs)
- **Component**: Dynamically imports `CanvasStage` component

---

### `/components` - React Components Directory

Reusable UI components and canvas/preview building blocks.

#### Core Canvas Components

##### `components/CanvasStage.tsx`
- **Purpose**: Main Konva-powered 2D canvas editor
- **Features**:
  - Renders dieline (box layout)
  - Displays all document nodes (images, PDFs, shapes, text)
  - Handles user interactions (drag, select, transform)
  - Manages zoom and pan
  - Provides selection handles via Konva Transformer
  - Syncs with Zustand store for state management
- **Technologies**: Konva, react-konva

##### `components/CanvasStageClient.tsx`
- **Purpose**: Client-only wrapper for CanvasStage
- **Implementation**: Dynamic import with SSR disabled
- **Note**: Alternative wrapper pattern (may be legacy)

#### Selection and Interaction

##### `components/SelectionToolbar.tsx`
- **Purpose**: Inline toolbar that appears when elements are selected
- **Features**:
  - Quick alignment actions
  - Layer ordering (bring to front, send to back)
  - Delete selected items
  - Positioned near selection on canvas

##### `components/PdfPagePickerModal.tsx`
- **Purpose**: Modal dialog for selecting PDF pages
- **Functionality**:
  - Displays thumbnails of all pages in uploaded PDF
  - Allows user to select specific page to place on canvas
  - Shows page numbers and previews

#### Panel Components

##### `components/LeftToolbar/` - Sidebar Toolbar

###### `components/LeftToolbar/index.tsx`
- **Purpose**: Main toolbar container component
- **Features**:
  - Vertical button layout with icons
  - Expandable/collapsible width (88px ↔ 128px)
  - Panel management (opens/closes panels)
  - Toolbar actions (zoom, rotate, properties)
  - Popup panels for PDF, Image, Shapes, Text
  - Uses Line Awesome icons
- **Toolbar Items**:
  - PDF panel
  - Add Image panel
  - Shapes panel
  - Add Text panel
  - Blocks panel
  - Save/Load Project panel
  - More panel
  - Properties (requires selection)
  - Rotate selection
  - Zoom controls (in, out, reset)

###### `components/LeftToolbar/PdfPanel.tsx`
- **Purpose**: Panel for uploading and managing PDF files
- **Features**:
  - File upload interface
  - PDF asset list
  - Page selection for placement
  - PDF management (delete, rename)

###### `components/LeftToolbar/ImagePanel.tsx`
- **Purpose**: Panel for uploading and managing image files
- **Features**:
  - Image file upload
  - Image asset gallery
  - Image placement on canvas
  - Asset management

###### `components/LeftToolbar/ShapesPanel.tsx`
- **Purpose**: Panel for adding geometric shapes
- **Features**:
  - Shape library (rectangles, circles, polygons, etc.)
  - Shape customization (fill, stroke, size)
  - Shape placement on canvas

###### `components/LeftToolbar/TextPanel.tsx`
- **Purpose**: Panel for adding and editing text
- **Features**:
  - Text input interface
  - Font selection
  - Text styling options
  - Text placement on canvas

##### `components/PropertiesPanel.tsx`
- **Purpose**: Bottom panel showing properties of selected element
- **Features**:
  - Position controls (X, Y coordinates)
  - Size controls (width, height)
  - Rotation control
  - Opacity control
  - Color/styling controls (varies by element type)
  - Lock aspect ratio toggle
- **Visibility**: Only shown when element is selected

##### `components/RightPanel3D.tsx`
- **Purpose**: Server component wrapper for 3D preview
- **Implementation**: Uses dynamic import to load client component

##### `components/RightPanel3DClient.tsx`
- **Purpose**: Client-side 3D preview component
- **Features**:
  - Three.js scene rendering
  - 3D box model matching dieline
  - Texture mapping from canvas
  - Interactive camera controls
  - Real-time synchronization with 2D canvas
- **Technologies**: Three.js, @react-three/fiber, @react-three/drei

##### `components/TopBar.tsx`
- **Purpose**: Top header bar component
- **Features**:
  - Brand/logo display
  - Workspace title
  - Global actions (save, export, settings)
  - Session-level controls

#### `components/README.md`
- **Purpose**: Documentation for components directory
- **Contents**: Overview of component organization and responsibilities

---

### `/lib` - Library Utilities Directory

Business logic, state management, and helper functions.

#### State Management

##### `lib/store.ts`
- **Purpose**: Main Zustand store for application state
- **State Includes**:
  - Document nodes (images, PDFs, shapes, text)
  - Selection state (selected node IDs)
  - Zoom level (0.5x to 2.5x)
  - Open panel (which toolbar panel is active)
  - Properties panel visibility
  - Assets (uploaded images and PDFs)
- **Actions**:
  - Node manipulation (add, update, delete)
  - Selection management
  - Zoom controls
  - Panel toggling
  - Rotation operations
- **Type Definitions**:
  - `DocumentNode` - Union type for all node types
  - `ImageNodeData`, `PdfNodeData`, `ShapeNodeData`, `TextNodeData`
  - `ImageAsset`, `PdfAsset`
  - `PanelKey` - Available panel types

##### `lib/previewStore.ts`
- **Purpose**: Separate Zustand store for 3D preview state
- **State Includes**:
  - Loading status
  - Selected material/texture
  - Preview-specific settings

#### Utility Functions

##### `lib/randomId.ts`
- **Purpose**: Generates unique IDs for new document nodes
- **Implementation**: Likely uses UUID or nanoid library
- **Usage**: Called when creating new nodes (images, shapes, text, etc.)

##### `lib/boxLayoutConfig.ts`
- **Purpose**: Configuration for packaging dieline dimensions
- **Contents**:
  - Box dimensions (width, height, depth)
  - Panel definitions (faces of the box)
  - Fold areas and crease lines
  - Coordinate mappings
- **Usage**: Used by both 2D canvas and 3D preview to maintain consistency

##### `lib/dieline.ts`
- **Purpose**: Dieline geometry and coordinate utilities
- **Functions**:
  - Canvas coordinate to dieline face mapping
  - Dieline path generation (SVG paths)
  - Face detection (which face a point belongs to)
  - Coordinate transformations
- **Usage**: Helps place elements correctly on box faces

##### `lib/texture.ts`
- **Purpose**: Texture creation and application utilities
- **Functions**:
  - Canvas snapshot to texture conversion
  - Texture mapping to Three.js materials
  - Texture coordinate calculation
  - Material property management
- **Usage**: Syncs 2D canvas artwork to 3D preview textures

##### `lib/text.ts`
- **Purpose**: Text rendering and measurement utilities
- **Functions**:
  - Text measurement (width, height calculation)
  - Curved text layout (text along paths)
  - Font weight to CSS font-style conversion
  - Text metrics calculation
- **Types**:
  - `StraightTextMetrics`
  - `CurvedGlyph`
  - `CurvedTextLayout`
- **Usage**: Handles text sizing and curved text rendering on canvas

#### `lib/README.md`
- **Purpose**: Documentation for library utilities
- **Contents**: Overview of each utility module and its purpose

---

### `/types` - TypeScript Type Definitions

#### `types/pdfjs-remote.d.ts`
- **Purpose**: TypeScript declarations for PDF.js library (loaded from CDN)
- **Types Defined**:
  - `PdfJsDocument` - PDF document interface
  - `PdfJsPage` - Individual page interface
  - `PdfJsViewport` - Viewport dimensions
  - `PdfJsLoadingTask` - Async loading task
- **Module Declaration**: Declares module for CDN URL
- **Usage**: Provides type safety when using PDF.js for PDF rendering

---

### `/public` - Static Assets Directory

Files in this directory are served at the root URL path.

#### `/public/dielines/`
- **Purpose**: Contains dieline SVG templates

##### `public/dielines/mailer.svg`
- **Purpose**: SVG template for mailer box dieline
- **Usage**: Loaded and rendered on canvas as the base layout
- **Format**: SVG path data defining box cut lines and fold lines

---

### `/node_modules` - Dependencies

- **Purpose**: Contains all npm package dependencies
- **Note**: Not committed to version control (in `.gitignore`)
- **Installation**: Created by running `npm install`
- **Size**: Large directory with hundreds of packages

---

## Technology Stack Summary

### Frontend Framework
- **Next.js 14** - React framework with App Router
- **React 18** - UI library

### Canvas & Graphics
- **Konva 9** - 2D canvas library
- **react-konva** - React bindings for Konva
- **Three.js** - 3D graphics library
- **@react-three/fiber** - React renderer for Three.js
- **@react-three/drei** - Three.js helpers

### State Management
- **Zustand** - Lightweight state management

### Styling
- **Tailwind CSS** - Utility-first CSS framework
- **PostCSS** - CSS processing
- **Autoprefixer** - Vendor prefix automation

### Development Tools
- **TypeScript** - Type safety
- **ESLint** - Code linting
- **Line Awesome** - Icon font (via CDN)

### PDF Processing
- **PDF.js** - PDF rendering (loaded from CDN)

---

## Data Flow Architecture

1. **User Interaction** → Component event handler
2. **Event Handler** → Zustand store action
3. **Store Update** → All subscribed components re-render
4. **Canvas Update** → Konva stage re-renders with new state
5. **3D Preview Update** → Three.js scene updates textures/geometry
6. **Properties Panel** → Shows updated values from store

---

## File Organization Principles

1. **App Router Convention**: Routes defined by file structure in `/app`
2. **Component Co-location**: Related components grouped (e.g., `LeftToolbar/`)
3. **Separation of Concerns**:
   - `/app` - Routing and page composition
   - `/components` - Reusable UI components
   - `/lib` - Business logic and utilities
   - `/types` - Type definitions
   - `/public` - Static assets
4. **Client/Server Split**: Client-only components use dynamic imports with `ssr: false`
5. **State Centralization**: Main state in `/lib/store.ts`, preview state in `/lib/previewStore.ts`

---

## Development Workflow

1. **Start Development**: `npm run dev` → `http://localhost:3000`
2. **Navigate to Editor**: Root redirects to `/personalize`
3. **Edit Files**: Changes hot-reload automatically
4. **Build Production**: `npm run build` → `npm start`

---

## Key Design Patterns

1. **Component Composition**: Large components broken into smaller, focused pieces
2. **State Management**: Centralized Zustand stores with typed actions
3. **Dynamic Imports**: Browser-only components (canvas, 3D) loaded client-side
4. **Type Safety**: Comprehensive TypeScript types for all data structures
5. **Responsive Design**: Tailwind utility classes for adaptive layouts

---

## Notes

- The project uses Next.js 14 App Router (not Pages Router)
- Client components must use `"use client"` directive
- Canvas and 3D preview require browser APIs, so they're dynamically imported
- State is managed with Zustand (lighter alternative to Redux)
- Styling is primarily Tailwind utility classes with minimal custom CSS
- PDF rendering uses PDF.js loaded from CDN (not npm package)

---

*This documentation covers all files, folders, and their purposes in the CloudLabs Personalizer project as of the current codebase state.*


